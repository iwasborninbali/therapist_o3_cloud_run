hash:018606408e9e0b17f754acafea8db2af694025b3cafaf1c4ed73640dbae03cc8
path:bot/telegram_router.py | source:bot/telegram_router.py | lastUpdated:2025-05-31T15:32:26.726113 | lines:354

This file implements the core routing and handling logic for a Telegram bot. It defines functions to process incoming updates, including commands like `/start`, `/help`, `/timezone`, and callback queries for user settings. The `handle_message` function is central, managing the conversation flow by fetching history, summaries, and notes from Firestore, sending context to an OpenAI client for a response, and saving the interaction. It includes features like idempotency for updates and retry logic for sending messages. The `setup_handlers` function registers all defined command and message handlers with the Telegram application instance.