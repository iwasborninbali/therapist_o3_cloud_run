hash:5e6e14ae47ff8536fc676c15a6d0a306eac34b9b4ee788c00e0fa253c4839d55
path:bot/telegram_router.py | source:bot/telegram_router.py | lastUpdated:2025-05-24T14:15:05.621197 | lines:382

This file sets up the core routing and handling logic for a Telegram bot using the `python-telegram-bot` library. It defines handlers for commands like `/start`, `/help`, and `/timezone`, as well as for regular text messages. The bot acts as an AI therapist, interacting with external services to store conversation history and user settings (like timezone) in Firestore, and using OpenAI to generate responses based on the history and a detailed default system prompt. It includes logic for managing conversation history and handles timezone selection via inline buttons. The `setup_handlers` function configures all the necessary message and command handlers for the Telegram application.