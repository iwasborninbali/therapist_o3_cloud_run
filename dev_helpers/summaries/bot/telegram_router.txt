hash:599c8c8068aa8a1f95d66ee098b938935c4c42f08fe89a654f939151898de102
path:bot/telegram_router.py | source:bot/telegram_router.py | lastUpdated:2025-05-25T18:59:52.218865 | lines:292

This file serves as the routing layer for a Telegram bot, handling incoming user interactions. It defines handlers for commands like `/start`, `/help`, and `/timezone`, and processes regular text messages. The `handle_message` function is central, retrieving user history and settings from Firestore, sending the conversation context to OpenAI for a response, and saving the interaction. It includes functionality for setting user timezones via inline buttons and ensures messages are sent reliably using `safe_send_message`. Finally, `setup_handlers` registers these functions with the Telegram application.